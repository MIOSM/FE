<div class="feed-container">
  <div *ngIf="loading && posts.length === 0" class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading posts...</p>
  </div>

  <div *ngIf="error" class="error-container">
    <i class="fas fa-exclamation-triangle error-icon"></i>
    <p class="error-message">{{ error }}</p>
    <button class="retry-btn" (click)="load()">
      <i class="fas fa-redo"></i>
      Try Again
    </button>
  </div>

  <div *ngIf="!loading && !error && posts.length === 0">
    <ng-container [ngSwitch]="emptyVariant">
      <ng-container *ngSwitchCase="'profile-posts'">
        <div class="empty-state posts-empty">
          <div class="empty-icon-container">
            <div class="empty-icon posts-icon">
              <i class="fas fa-feather-alt"></i>
            </div>
            <div class="empty-icon-bg"></div>
          </div>
          <div class="empty-content">
            <ng-container *ngIf="isOwnProfileView(); else otherUserPostsEmpty">
              <h3>No posts yet</h3>
              <p>Share your thoughts, photos, and moments with your followers. Your posts will appear here.</p>
              <div class="empty-suggestion">
                <i class="fas fa-lightbulb"></i>
                <span>Tip: Click the button below to create your first post and start sharing!</span>
              </div>
              <button class="create-post-btn enhanced" (click)="goToCreatePost()">
                <i class="fas fa-plus"></i>
                Create your first post
              </button>
            </ng-container>
            <ng-template #otherUserPostsEmpty>
              <h3>No posts yet</h3>
              <p>{{ username || 'This user' }} hasn't shared any posts yet. Check back later for updates!</p>
              <div class="empty-suggestion">
                <i class="fas fa-info-circle"></i>
                <span>New posts from {{ username || 'this user' }} will appear here when they start sharing.</span>
              </div>
            </ng-template>
          </div>
        </div>
      </ng-container>

      <ng-container *ngSwitchCase="'profile-likes'">
        <div class="empty-state likes-empty">
          <div class="empty-icon-container">
            <div class="empty-icon likes-icon">
              <i class="fas fa-heart"></i>
            </div>
            <div class="empty-icon-bg"></div>
          </div>
          <div class="empty-content">
            <ng-container *ngIf="isOwnProfileView(); else otherUserLikesEmpty">
              <h3>No liked posts yet</h3>
              <p>When you like posts, they'll appear here so you can easily find them later.</p>
              <div class="empty-suggestion">
                <i class="fas fa-lightbulb"></i>
                <span>Tip: Double-tap or click the heart icon on posts you enjoy!</span>
              </div>
            </ng-container>
            <ng-template #otherUserLikesEmpty>
              <h3>No liked posts</h3>
              <p>{{ username || 'This user' }} hasn't liked any posts yet.</p>
              <div class="empty-suggestion">
                <i class="fas fa-info-circle"></i>
                <span>Liked posts will appear here when they start engaging with content.</span>
              </div>
            </ng-template>
          </div>
        </div>
      </ng-container>

      <ng-container *ngSwitchDefault>
        <div class="empty-container">
          <i class="fas fa-newspaper empty-icon"></i>
          <h3 class="empty-title">No posts yet</h3>
          <p class="empty-message">Nothing to show here for now.</p>
        </div>
      </ng-container>
    </ng-container>
  </div>

  <div *ngIf="!loading && !error && posts.length > 0" class="posts-feed">
    <app-post-card
      *ngFor="let post of posts; trackBy: trackByPostId"
      [post]="post"
      [liking]="isLiking(post.postId)"
      [showOwnerActions]="isOwner(post)"
      (like)="onLikeToggled($event)"
      (openUser)="onOpenUser($event)"
      (delete)="onDeletePost($event)"
      (openMedia)="openMediaViewer($event.urls, $event.index, $event.type)">
    </app-post-card>
  </div>
</div>

<div class="media-viewer-overlay" *ngIf="showMediaViewer" (click)="closeMediaViewer()">
  <div class="media-viewer-container" (click)="$event.stopPropagation()">
    <button class="close-button" (click)="closeMediaViewer()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    <ng-container *ngIf="currentMediaType === 'image'">
      <img [src]="currentMediaUrls[currentMediaIndex]" class="media-content" alt="Media content" />
    </ng-container>

    <ng-container *ngIf="currentMediaType === 'video'">
      <video [src]="currentMediaUrls[currentMediaIndex]" class="media-content" controls autoplay></video>
    </ng-container>

    <div class="media-navigation">
      <button (click)="$event.stopPropagation(); navigateMedia('prev')" *ngIf="currentMediaUrls.length > 1">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <div></div>
      <button (click)="$event.stopPropagation(); navigateMedia('next')" *ngIf="currentMediaUrls.length > 1">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <div class="media-counter" *ngIf="currentMediaUrls.length > 1">
      {{ currentMediaIndex + 1 }} / {{ currentMediaUrls.length }}
    </div>
  </div>
</div>
