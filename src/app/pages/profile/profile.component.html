<div class="profile-page" *ngIf="profileUser">
  <div class="profile-header">
    <div class="cover-photo">
      <img *ngIf="hasValidCoverPhoto()" [src]="userCoverPhoto" alt="Cover Photo" class="cover-image" />
      <div *ngIf="!hasValidCoverPhoto()" class="cover-fallback">
        <div class="cover-pattern"></div>
      </div>
    </div>

    <div class="profile-info">
      <div class="profile-picture">
        <div class="avatar-container">
          <img *ngIf="hasValidAvatar()" [src]="userAvatar" alt="Profile Picture" class="avatar-image" />
          <div *ngIf="!hasValidAvatar()" class="avatar-fallback" [style.background-color]="getAvatarColor()">
            <span class="avatar-initial">{{ getAvatarInitial() }}</span>
          </div>
        </div>
        <button *ngIf="isOwnProfile" class="edit-profile-btn" (click)="editProfile()">
          <i class="fas fa-edit"></i>
          Edit Profile
        </button>
        <button *ngIf="!isOwnProfile" class="follow-btn" 
                [class.following]="isFollowing"
                [disabled]="isLoadingFollow"
                (click)="toggleFollow()">
          <i class="fas" [class.fa-user-plus]="!isFollowing" [class.fa-user-check]="isFollowing"></i>
          <span *ngIf="!isLoadingFollow">{{ isFollowing ? 'Following' : 'Follow' }}</span>
          <span *ngIf="isLoadingFollow">
            <i class="fas fa-spinner fa-spin"></i>
          </span>
        </button>
      </div>

      <div class="user-details">
        <h1 class="user-name">
          <span *ngIf="profileUser.firstName && profileUser.lastName">{{ profileUser.firstName }} {{ profileUser.lastName }}</span>
          <span *ngIf="!profileUser.firstName || !profileUser.lastName">{{ profileUser.username }}</span>
        </h1>
        <p class="user-username">&#64;{{ profileUser.username }}</p>
        
        <div class="user-bio">
          <p class="bio-text">{{ profileUser.bio }}</p>
        </div>
        
        <div class="user-stats">
          <div class="stat-item" (click)="openFollowingModal()" style="cursor: pointer;">
            <span class="stat-number">{{ followingCount }}</span>
            <span class="stat-label">Following</span>
          </div>
          <div class="stat-item" (click)="openFollowersModal()" style="cursor: pointer;">
            <span class="stat-number">{{ followersCount }}</span>
            <span class="stat-label">Followers</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ userPosts.length }}</span>
            <span class="stat-label">Posts</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ totalLikesCount }}</span>
            <span class="stat-label">Likes</span>
          </div>
        </div>
        
        <div class="user-contact" *ngIf="isOwnProfile && profileUser.email">
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <span>{{ profileUser.email }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="profile-nav">
    <div class="nav-tabs">
      <button class="nav-tab" [class.active]="activeTab === 'posts'" (click)="setActiveTab('posts')">
        <i class="fas fa-list"></i>
        <span>Posts</span>
      </button>
      <button class="nav-tab" [class.active]="activeTab === 'likes'" (click)="setActiveTab('likes')">
        <i class="fas fa-heart"></i>
        <span>Likes</span>
      </button>
      <button class="nav-tab" [class.active]="activeTab === 'bookmarks'" (click)="setActiveTab('bookmarks')">
        <i class="fas fa-bookmark"></i>
        <span>Bookmarks</span>
      </button>
    </div>
  </div>

  <div class="profile-content">
    <div class="posts-section" *ngIf="activeTab === 'posts'">
      <div class="create-post-container" *ngIf="isOwnProfile && postsCountForUser > 0">
        <button class="create-post-btn" (click)="createPost()">
          <div class="post-avatar">
            <img *ngIf="hasValidAvatar()" [src]="userAvatar" alt="User Avatar" />
            <div *ngIf="!hasValidAvatar()" class="avatar-text" [style.background-color]="getAvatarColor()">
              {{ getAvatarInitial() }}
            </div>
          </div>
          <span class="create-post-text">What's on your mind?</span>
        </button>
      </div>
      <app-post-list [mode]="'profile'" [username]="profileUser?.username" [emptyVariant]="'profile-posts'" (postsChanged)="onPostsChanged($event)"></app-post-list>
    </div>

    <div class="likes-section" *ngIf="activeTab === 'likes'">
      <app-post-list [mode]="'likes'" [username]="profileUser?.username" [emptyVariant]="'profile-likes'"></app-post-list>
    </div>

    <div class="bookmarks-section" *ngIf="activeTab === 'bookmarks'">
      <div class="empty-state bookmarks-empty">
        <div class="empty-icon-container">
          <div class="empty-icon bookmarks-icon">
            <i class="fas fa-bookmark"></i>
          </div>
          <div class="empty-icon-bg"></div>
        </div>
        <div class="empty-content">
          <ng-container *ngIf="isOwnProfile">
            <h3>No bookmarks yet</h3>
            <p>Save posts you want to read later by bookmarking them. They'll appear here for easy access.</p>
            <div class="empty-suggestion">
              <i class="fas fa-lightbulb"></i>
              <span>Tip: Click the bookmark icon on any post to save it for later!</span>
            </div>
          </ng-container>
          <ng-container *ngIf="!isOwnProfile">
            <h3>Bookmarks are private</h3>
            <p>Only {{ profileUser?.username || 'this user' }} can see their saved posts and bookmarks.</p>
            <div class="empty-suggestion privacy-note">
              <i class="fas fa-lock"></i>
              <span>This section is private to protect user privacy.</span>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showFollowersModal" (click)="closeFollowersModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Followers</h3>
        <button class="close-button" (click)="closeFollowersModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-content">
        <div class="loading-container" *ngIf="isLoadingModal">
          <div class="spinner"></div>
          <p>Loading followers...</p>
        </div>
        <div class="users-list" *ngIf="!isLoadingModal">
          <div class="user-item" *ngFor="let user of followersList" (click)="navigateToUser(user.username)">
            <div class="user-avatar">
              <img *ngIf="user.avatarUrl" [src]="getUserAvatarUrl(user)" [alt]="user.username" />
              <div *ngIf="!user.avatarUrl" class="avatar-fallback-small">
                <span class="avatar-initial-small">{{ user.username.charAt(0).toUpperCase() }}</span>
              </div>
            </div>
            <div class="user-info">
              <h4 class="username">{{ user.username }}</h4>
              <p class="bio" *ngIf="user.bio">{{ user.bio }}</p>
            </div>
          </div>
          <div class="empty-state" *ngIf="followersList.length === 0">
            <p>No followers yet</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showFollowingModal" (click)="closeFollowingModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Following</h3>
        <button class="close-button" (click)="closeFollowingModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-content">
        <div class="loading-container" *ngIf="isLoadingModal">
          <div class="spinner"></div>
          <p>Loading following...</p>
        </div>
        <div class="users-list" *ngIf="!isLoadingModal">
          <div class="user-item" *ngFor="let user of followingList" (click)="navigateToUser(user.username)">
            <div class="user-avatar">
              <img *ngIf="user.avatarUrl" [src]="getUserAvatarUrl(user)" [alt]="user.username" />
              <div *ngIf="!user.avatarUrl" class="avatar-fallback-small">
                <span class="avatar-initial-small">{{ user.username.charAt(0).toUpperCase() }}</span>
              </div>
            </div>
            <div class="user-info">
              <h4 class="username">{{ user.username }}</h4>
              <p class="bio" *ngIf="user.bio">{{ user.bio }}</p>
            </div>
          </div>
          <div class="empty-state" *ngIf="followingList.length === 0">
            <p>Not following anyone yet</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="loading-container" *ngIf="!profileUser && !isLoadingProfile">
  <div class="spinner"></div>
  <p>Loading user information...</p>
</div>

<div class="loading-container" *ngIf="isLoadingProfile">
  <div class="spinner"></div>
  <p>Loading profile...</p>
</div> 