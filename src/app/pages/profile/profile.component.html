<div class="profile-page" *ngIf="profileUser">
  <div class="profile-header">
    <div class="cover-photo">
      <img [src]="userCoverPhoto" alt="Cover Photo" class="cover-image" />
    </div>

    <div class="profile-info">
      <div class="profile-picture">
        <div class="avatar-container">
          <img [src]="userAvatar" alt="Profile Picture" class="avatar-image" />
        </div>
        <button *ngIf="isOwnProfile" class="edit-profile-btn" (click)="editProfile()">
          <i class="fas fa-edit"></i>
          Edit Profile
        </button>
      </div>

      <div class="user-details">
        <h1 class="user-name">
          <span *ngIf="profileUser.firstName && profileUser.lastName">{{ profileUser.firstName }} {{ profileUser.lastName }}</span>
          <span *ngIf="!profileUser.firstName || !profileUser.lastName">{{ profileUser.username }}</span>
        </h1>
        <p class="user-username">&#64;{{ profileUser.username }}</p>
        
        <div class="user-bio">
          <p class="bio-text">{{ profileUser.bio }}</p>
        </div>
        
        <div class="user-stats">
          <div class="stat-item">
            <span class="stat-number">0</span>
            <span class="stat-label">Following</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">0</span>
            <span class="stat-label">Followers</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ userPosts.length }}</span>
            <span class="stat-label">Posts</span>
          </div>
        </div>
        
        <div class="user-contact" *ngIf="isOwnProfile && profileUser.email">
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <span>{{ profileUser.email }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="profile-nav">
    <div class="nav-tabs">
      <button class="nav-tab active">
        <i class="fas fa-list"></i>
        <span>Posts</span>
      </button>
      <button class="nav-tab">
        <i class="fas fa-heart"></i>
        <span>Likes</span>
      </button>
      <button class="nav-tab">
        <i class="fas fa-bookmark"></i>
        <span>Bookmarks</span>
      </button>
    </div>
  </div>

  <div class="profile-content">
    <div class="posts-section">
      <div class="create-post-container" *ngIf="isOwnProfile && userPosts.length > 0">
        <button class="create-post-btn" (click)="createPost()">
          <div class="post-avatar" [style.background]="'var(--primary-100)'">
            <span class="avatar-text" *ngIf="!currentUser?.avatar">
              {{ (currentUser?.username?.charAt(0) || 'U').toUpperCase() }}
            </span>
            <img [src]="currentUser?.avatar" *ngIf="currentUser?.avatar" alt="User Avatar" />
          </div>
          <span class="create-post-text">What's on your mind?</span>
        </button>
      </div>

      <div class="loading-posts" *ngIf="isLoadingPosts">
        <div class="spinner"></div>
        <p>Loading posts...</p>
      </div>

      <div class="posts-list" *ngIf="!isLoadingPosts && userPosts.length > 0">
        <div class="post-card" *ngFor="let post of userPosts">
          <div class="post-header">
            <div class="post-avatar" [style.background]="'var(--primary-100)'">
              <span class="avatar-text" *ngIf="!profileUser?.avatar && !profileUser?.avatarUrl">
                {{ (profileUser?.username?.charAt(0) || 'U').toUpperCase() }}
              </span>
              <img [src]="userAvatar" *ngIf="profileUser?.avatar || profileUser?.avatarUrl" alt="User Avatar" />
            </div>
            <div class="post-user-info">
              <h4 class="post-username">{{ post.username || 'User' }}</h4>
              <p class="post-time">{{ post.createdAt | date:'medium' }}</p>
            </div>
            <div class="post-actions-right" *ngIf="isCurrentUserPost(post)">
              <button class="action-btn more-options" (click)="togglePostMenu(post.postId, $event)">
                <i class="fas fa-ellipsis-h"></i>
              </button>
              <div class="post-dropdown-menu" [class.show]="isMenuOpen(post.postId)">
                <button class="dropdown-item delete-btn" (click)="onDeletePost(post.postId, $event)">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
          </div>

          <div class="post-content">
            <p class="post-text">{{ post.content }}</p>

            <div 
              class="post-images {{ 'image-count-' + post.imageUrls.length }} {{ 'image-count-' + post.imageUrls.length }}-images" 
              *ngIf="post.imageUrls && post.imageUrls.length > 0"
            >
              <img 
                *ngFor="let imageUrl of post.imageUrls; let i = index"
                [src]="getPostImageUrl(imageUrl)" 
                alt="Post image" 
                class="post-image"
                (click)="openMediaViewer(post.imageUrls, i, 'image')"
                loading="lazy"
              >
            </div>

            <div class="post-videos" *ngIf="post.videoUrls && post.videoUrls.length > 0">
              <video 
                *ngFor="let videoUrl of post.videoUrls; let i = index"
                [src]="getPostImageUrl(videoUrl)"
                (click)="$event.preventDefault(); openMediaViewer(post.videoUrls, i, 'video')"
                controls
                class="post-video">
              </video>
            </div>
          </div>

          <div class="post-actions">
            <button class="action-btn">
              <i class="fas fa-heart"></i>
              <span>0</span>
            </button>
            <button class="action-btn">
              <i class="fas fa-comment"></i>
              <span>0</span>
            </button>
            <button class="action-btn">
              <i class="fas fa-share"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="!isLoadingPosts && userPosts.length === 0">
        <div class="empty-icon">
          <i class="fas fa-feather-alt"></i>
        </div>
        <h3>No posts yet</h3>
        <p>When you create posts, they'll show up here.</p>
        <button class="create-post-btn" (click)="createPost()">
          <i class="fas fa-plus"></i>
          Create your first post
        </button>
      </div>
    </div>
  </div>
  <div class="media-viewer-overlay" *ngIf="showMediaViewer" (click)="closeMediaViewer()">
    <div class="media-viewer-container" (click)="$event.stopPropagation()">
      <button class="close-button" (click)="closeMediaViewer()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      
      <ng-container *ngIf="currentMediaType === 'image'">
        <img [src]="currentMediaUrls[currentMediaIndex]" class="media-content" alt="Media content" />
      </ng-container>
      
      <ng-container *ngIf="currentMediaType === 'video'">
        <video [src]="currentMediaUrls[currentMediaIndex]" class="media-content" controls autoplay></video>
      </ng-container>
      
      <div class="media-navigation">
        <button (click)="$event.stopPropagation(); navigateMedia('prev')" *ngIf="currentMediaUrls.length > 1">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <div></div> 
        <button (click)="$event.stopPropagation(); navigateMedia('next')" *ngIf="currentMediaUrls.length > 1">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      
      <div class="media-counter" *ngIf="currentMediaUrls.length > 1">
        {{ currentMediaIndex + 1 }} / {{ currentMediaUrls.length }}
      </div>
    </div>
  </div>
</div>

<div class="loading-container" *ngIf="!profileUser && !isLoadingProfile">
  <div class="spinner"></div>
  <p>Loading user information...</p>
</div>

<div class="loading-container" *ngIf="isLoadingProfile">
  <div class="spinner"></div>
  <p>Loading profile...</p>
</div> 