<div class="settings-container">
  <div class="settings-card">
    <h2>Profile Settings</h2>
    <p class="description">Update your profile information below.</p>

    <form [formGroup]="settingsForm" (ngSubmit)="onSubmit()" class="settings-form">
      <div class="form-group">
        <label for="username" class="form-label">Username</label>
        <input
          type="text"
          id="username"
          formControlName="username"
          class="form-control"
          [class.invalid]="isFieldInvalid('username')"
          placeholder="Enter your username"
        />
        <div class="error-message" *ngIf="isFieldInvalid('username')">
          {{ getErrorMessage('username') }}
        </div>
      </div>

      <div class="form-group">
        <label for="firstName" class="form-label">First Name</label>
        <input
          type="text"
          id="firstName"
          formControlName="firstName"
          class="form-control"
          [class.invalid]="isFieldInvalid('firstName')"
          placeholder="Enter your first name"
        />
        <div class="error-message" *ngIf="isFieldInvalid('firstName')">
          {{ getErrorMessage('firstName') }}
        </div>
      </div>

      <div class="form-group">
        <label for="lastName" class="form-label">Last Name</label>
        <input
          type="text"
          id="lastName"
          formControlName="lastName"
          class="form-control"
          [class.invalid]="isFieldInvalid('lastName')"
          placeholder="Enter your last name"
        />
        <div class="error-message" *ngIf="isFieldInvalid('lastName')">
          {{ getErrorMessage('lastName') }}
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Avatar</label>
        <div class="image-upload-container">
          <div class="image-preview" (click)="openAvatarModal()">
            <img 
              [src]="getCurrentAvatarUrl() || 'assets/default-avatar.png'" 
              alt="Avatar" 
              class="preview-image"
              (error)="onImageError($event)"
            />
            <div class="image-overlay">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7,10 12,15 17,10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              <span>Change Avatar</span>
            </div>
          </div>
          <div class="help-text">Click to upload a new avatar image</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Cover Photo</label>
        <div class="image-upload-container">
          <div class="image-preview cover-preview" (click)="openCoverModal()">
            <img 
              [src]="getCurrentCoverUrl() || 'assets/default-cover.png'" 
              alt="Cover Photo" 
              class="preview-image"
              (error)="onImageError($event)"
            />
            <div class="image-overlay">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7,10 12,15 17,10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              <span>Change Cover</span>
            </div>
          </div>
          <div class="help-text">Click to upload a new cover photo</div>
        </div>
      </div>

      <div class="form-group">
        <label for="bio" class="form-label">Bio</label>
        <textarea
          id="bio"
          formControlName="bio"
          class="form-control"
          rows="4"
          placeholder="Tell people about yourself..."
        ></textarea>
        <div class="help-text">Write a short bio about yourself</div>
      </div>

      <div class="message-container">
        <div class="success-message" *ngIf="successMessage">
          {{ successMessage }}
        </div>
        <div class="error-message" *ngIf="errorMessage">
          {{ errorMessage }}
        </div>
      </div>

      <button
        type="submit"
        class="submit-btn"
        [disabled]="settingsForm.invalid || isLoading"
      >
        <span *ngIf="!isLoading">Update Profile</span>
        <span *ngIf="isLoading" class="loading-spinner">
          <svg class="spinner" viewBox="0 0 50 50">
            <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
          </svg>
          Updating...
        </span>
      </button>
    </form>
  </div>

  <app-image-upload-modal
    [isOpen]="showAvatarModal"
    [title]="'Upload Avatar'"
    [currentImageUrl]="getCurrentAvatarUrl()"
    (closeModal)="closeAvatarModal()"
    (imageSelected)="onAvatarSelected($event)"
  ></app-image-upload-modal>

  <app-image-upload-modal
    [isOpen]="showCoverModal"
    [title]="'Upload Cover Photo'"
    [currentImageUrl]="getCurrentCoverUrl()"
    (closeModal)="closeCoverModal()"
    (imageSelected)="onCoverSelected($event)"
  ></app-image-upload-modal>
</div>
