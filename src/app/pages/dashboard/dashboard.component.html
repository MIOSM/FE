<div class="dashboard-container">
  <div class="dashboard-header">
    <h1 class="dashboard-title">
      <i class="fas fa-home"></i>
      Dashboard
    </h1>
    <button class="refresh-btn" (click)="onRefresh()" [disabled]="loading">
      <i class="fas fa-sync-alt" [class.spinning]="loading"></i>
    </button>
  </div>

  <div class="feed-container">
    <div *ngIf="loading && posts.length === 0" class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Loading latest posts...</p>
    </div>

    <div *ngIf="error" class="error-container">
      <i class="fas fa-exclamation-triangle error-icon"></i>
      <p class="error-message">{{ error }}</p>
      <button class="retry-btn" (click)="onRefresh()">
        <i class="fas fa-redo"></i>
        Try Again
      </button>
    </div>

    <div *ngIf="!loading && !error && posts.length === 0" class="empty-container">
      <i class="fas fa-newspaper empty-icon"></i>
      <h3 class="empty-title">No posts yet</h3>
      <p class="empty-message">Be the first to share something!</p>
    </div>

    <div *ngIf="!loading && !error && posts.length > 0" class="posts-feed">
      <article *ngFor="let post of posts; trackBy: trackByPostId" class="post-card">
        <header class="post-header">
          <div class="post-avatar" (click)="navigateToProfile(post.username)">
            <img 
              *ngIf="hasValidAvatar(post.userAvatar)" 
              [src]="getAvatarUrl(post.userAvatar)" 
              [alt]="post.username + ' avatar'"
              (error)="onImageError($event)"
            />
            <div *ngIf="!hasValidAvatar(post.userAvatar)" 
                 class="avatar-fallback" 
                 [style.background-color]="getAvatarColor(post.username)"
                 [style.color]="getTextColor(getAvatarColor(post.username))">
              {{ getAvatarInitial(post.username) }}
            </div>
          </div>
          <div class="post-user-info">
            <span class="post-username" (click)="navigateToProfile(post.username)">{{ post.username }}</span>
            <time class="post-time">{{ post.createdAt | date:'medium' }}</time>
          </div>
        </header>

        <div class="post-content">
          <p class="post-text">{{ post.content }}</p>

          <div 
            class="post-images {{ 'image-count-' + post.imageUrls.length }}" 
            *ngIf="post.imageUrls && post.imageUrls.length > 0"
          >
            <img 
              *ngFor="let imageUrl of post.imageUrls; let i = index" 
              [src]="getImageProxyUrl(imageUrl)"
              [alt]="'Post image ' + (i + 1)"
              class="post-image"
              (error)="onImageError($event)"
              (click)="openMediaViewer(post.imageUrls, i, 'image')"
            />
          </div>

          <div *ngIf="post.videoUrls && post.videoUrls.length > 0" class="post-videos">
            <video 
              *ngFor="let videoUrl of post.videoUrls; let i = index" 
              [src]="getImageProxyUrl(videoUrl)"
              class="post-video"
              controls
              preload="metadata"
              (click)="$event.preventDefault(); openMediaViewer(post.videoUrls, i, 'video')"
            >
              Your browser does not support the video tag.
            </video>
          </div>
        </div>

          <div class="post-actions">
            <button 
              class="action-btn like-btn" 
              [class.liked]="post.isLikedByCurrentUser"
              [disabled]="isLiking(post.postId)"
              (click)="toggleLike(post)"
            >
              <i class="fas fa-heart" *ngIf="post.isLikedByCurrentUser"></i>
              <i class="far fa-heart" *ngIf="!post.isLikedByCurrentUser"></i>
              <i class="fas fa-spinner fa-spin" *ngIf="isLiking(post.postId)"></i>
              <span>{{ post.likeCount || 0 }}</span>
            </button>
            <button class="action-btn comment-btn">
              <i class="far fa-comment"></i>
              <span>Comment</span>
            </button>
            <button class="action-btn share-btn">
              <i class="fas fa-share"></i>
              <span>Share</span>
            </button>
          </div>
      </article>
    </div>
  </div>

  <div class="media-viewer-overlay" *ngIf="showMediaViewer" (click)="closeMediaViewer()">
    <div class="media-viewer-container" (click)="$event.stopPropagation()">
      <button class="close-button" (click)="closeMediaViewer()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <ng-container *ngIf="currentMediaType === 'image'">
        <img [src]="currentMediaUrls[currentMediaIndex]" class="media-content" alt="Media content" />
      </ng-container>

      <ng-container *ngIf="currentMediaType === 'video'">
        <video [src]="currentMediaUrls[currentMediaIndex]" class="media-content" controls autoplay></video>
      </ng-container>

      <div class="media-navigation">
        <button (click)="$event.stopPropagation(); navigateMedia('prev')" *ngIf="currentMediaUrls.length > 1">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <div></div>
        <button (click)="$event.stopPropagation(); navigateMedia('next')" *ngIf="currentMediaUrls.length > 1">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>

      <div class="media-counter" *ngIf="currentMediaUrls.length > 1">
        {{ currentMediaIndex + 1 }} / {{ currentMediaUrls.length }}
      </div>
    </div>
  </div>
</div>
